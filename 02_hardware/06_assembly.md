# 2.6 조립 가이드

3D 프린팅과 부품 구매가 완료되었다면 이제 조립할 차례입니다. 이 가이드는 단계별 조립 과정을 안내합니다.

## 1. 조립 준비

### 필요한 공구

| 공구 | 용도 | 가격 |
|------|------|------|
| 플러시 커터 | 서포트 제거 | $6.99 |
| 육각 렌치 세트 | M3 나사 조임 | $8.99 |
| 드라이버 세트 | 조립 전반 | $6.00 |
| 니퍼 | 케이블 정리 | $5.49 |
| 멀티미터 | 전기 테스트 | $15 |
| 납땜 인두 (선택) | 커넥터 작업 | $25 |

**총 공구 비용:** ~$50 (기본), ~$75 (전체)

### 조립 전 체크리스트

**3D 프린팅 부품:**
- [ ] SO-101 팔 부품 (좌/우 각 세트)
- [ ] 소프트 핑거 (TPU) 4개
- [ ] 베이스 플레이트 (상/하단)
- [ ] 옴니휠 마운트 3개
- [ ] 짐벌 부품
- [ ] 케이블 클립

**전자 부품:**
- [ ] STS3215 서보 모터 17개 (+ 예비 2개)
- [ ] Raspberry Pi 4/5
- [ ] 모터 드라이버 보드 2개
- [ ] Anker SOLIX C300 배터리
- [ ] 옴니휠 3개
- [ ] 카메라 (C920 또는 D415)
- [ ] 핸드 카메라 2개

**기계 부품:**
- [ ] M3 나사 세트 (100+개)
- [ ] M3 너트
- [ ] 5264 전선
- [ ] USB 케이블
- [ ] IKEA RÅSKOG 카트

---

## 2. 조립 타임라인

| 단계 | 작업 | 예상 시간 | 난이도 |
|------|------|-----------|--------|
| 1 | 베이스 플레이트 조립 | 2시간 | 하 |
| 2 | 옴니휠 마운트 | 1.5시간 | 하 |
| 3 | 로봇 팔 조립 (좌/우) | 6시간 | 중 |
| 4 | 헤드 짐벌 조립 | 1시간 | 하 |
| 5 | 전기 배선 | 3시간 | 중 |
| 6 | 센서 장착 | 1.5시간 | 하 |
| 7 | 소프트웨어 설정 | 2시간 | 중 |
| 8 | 테스트 및 캘리브레이션 | 2시간 | 중 |

**총 예상 시간:** **~19시간** (숙련도에 따라 ±5시간)

---

## 3. Phase 1: 베이스 플레이트 조립

### Step 1.1: IKEA 카트 준비

1. RÅSKOG 카트 조립 (IKEA 설명서 참조)
2. 기존 바퀴 4개 제거 (캐스터 나사 풀기)
3. 상단 선반 분리 (옴니휠 마운트용)

### Step 1.2: 베이스 플레이트 장착

```
[하단 플레이트]
     ↓
┌────────────┐
│ IKEA 카트  │
│ 중간 선반  │
└────────────┘
     ↑
[상단 플레이트]
```

**조립 순서:**
1. 하단 플레이트를 카트 중간 선반에 M3×10 나사 8개로 고정
2. 배터리 고정용 벨크로 테이프 부착
3. 상단 플레이트를 상단 선반에 고정 (나사 8개)

**측정 검증:**
- 플레이트 수평도 ±2° 이내
- 나사 조임 토크 균일하게

---

## 4. Phase 2: 옴니휠 마운트

### Step 2.1: 모터 마운트 조립

**부품:**
- Drive_Motor_Mount_upgraded.step (3D 프린트)
- STS3215 서보 모터 3개 (ID 13, 14, 15)
- M3×8 나사 12개

**조립:**
```
    [모터 ID 13]
         ↑
    ┌────┴────┐
[15]│         │[14]
    └─────────┘
   120°    120°
```

1. 각 모터를 마운트에 나사 4개로 고정
2. 모터 케이블을 아래로 라우팅
3. 마운트를 카트 하단에 고정

### Step 2.2: 옴니휠 장착

1. Servo_Wheel_Hub를 모터 스플라인에 끼움
2. M3×6 세트 스크류로 고정
3. 옴니휠을 허브에 M3×8 나사 4개로 고정
4. 휠 자유 회전 확인

**측정 검증:**
- 휠 높이 차이 ±2mm 이내
- 3개 휠이 바닥에 균일하게 접촉

---

## 5. Phase 3: 로봇 팔 조립

### Step 3.1: 서보 ID 할당

| 팔 | 조인트 | 서보 ID |
|------|--------|---------|
| 왼쪽 | 베이스 (Pan) | 1 |
| 왼쪽 | 리프트 (Lift) | 2 |
| 왼쪽 | 엘보 (Elbow) | 3 |
| 왼쪽 | 리스트 플렉스 | 4 |
| 왼쪽 | 리스트 롤 | 5 |
| 왼쪽 | 그리퍼 | 6 |
| 오른쪽 | 베이스 | 7 |
| 오른쪽 | 리프트 | 8 |
| 오른쪽 | 엘보 | 9 |
| 오른쪽 | 리스트 플렉스 | 10 |
| 오른쪽 | 리스트 롤 | 11 |
| 오른쪽 | 그리퍼 | 12 |

### Step 3.2: SO-101 팔 조립 (왼쪽 먼저)

**1단계: 베이스 조인트**
```python
# 서보 모터 1번을 베이스 마운트에 장착
# M3×8 나사 4개로 고정
# 케이블을 뒤쪽으로 라우팅
```

**2단계: 리프트 조인트**
- 서보 2번을 상완에 고정
- 베이스 조인트와 연결
- 각도 범위 테스트 (-5.7° ~ +197.5°)

**3단계: 엘보 조인트**
- 서보 3번을 하완에 고정
- 상완과 연결
- 각도 범위 테스트 (-11.5° ~ +180°)

**4단계: 손목 조인트**
- 서보 4, 5번을 손목에 장착
- Wrist Flex (4번): ±123°
- Wrist Roll (5번): ±180°

**5단계: 그리퍼**
- 서보 6번 장착
- 소프트 핑거 (TPU) 또는 하드 핑거 (PLA) 선택
- 핑거 각도 테스트 (0° ~ 60°)

**오른쪽 팔:** 동일 과정 반복 (서보 ID 7~12)

### Step 3.3: 팔 장착

1. 왼쪽/오른쪽 팔을 상단 플레이트에 고정
2. 팔 간격: 35cm (어깨 너비)
3. M3×12 나사 6개로 고정

---

## 6. Phase 4: 헤드 짐벌

### Step 4.1: 짐벌 조립

**부품:**
- Gimbal_mesh_all_d435.stl (또는 d455)
- 서보 16 (Pan)
- 서보 17 (Tilt)

**조립:**
```
    [카메라]
        ↓
    ┌───┴───┐
    │ Tilt  │ (Servo 17)
    └───┬───┘
        ↓
    ┌───┴───┐
    │  Pan  │ (Servo 16)
    └───────┘
```

### Step 4.2: 카메라 장착

1. RealSense D415를 짐벌 마운트에 고정
2. USB 3.0 케이블 연결 (30cm)
3. 케이블을 클립으로 정리

---

## 7. Phase 5: 전기 배선

### Step 5.1: 전원 분배

```
[Anker SOLIX C300]
       │
   ┌───┴───┐
   │ 12V   │ 5V USB
   ↓       ↓
[모터 보드] [라즈베리파이]
   │
   ├── 서보 1~6  (왼쪽 팔)
   ├── 서보 7~12 (오른쪽 팔)
   ├── 서보 13~15 (옴니휠)
   └── 서보 16~17 (짐벌)
```

### Step 5.2: 시리얼 버스 연결

**모터 보드 1:**
- TTL 시리얼: TX → 서보 1 RX
- 데이지 체인: 서보 1 TX → 서보 2 RX → ... → 서보 9

**모터 보드 2:**
- TTL 시리얼: TX → 서보 10 RX
- 데이지 체인: 서보 10~17

### Step 5.3: 전선 정리

- 5264 전선 (적/흑)으로 전원 분배
- 케이블 타이로 고정
- 동선이 움직이는 부분 피하기

---

## 8. Phase 6: 센서 장착

### Step 6.1: 헤드 카메라

- RealSense D415를 짐벌에 고정 (Phase 4 참조)
- USB 3.0을 라즈베리파이에 연결

### Step 6.2: 핸드 카메라

```python
# 왼쪽 손목 카메라
32x32mm UVC 모듈 → 손목 마운트 → USB 케이블 팔 내부 라우팅

# 오른쪽 손목 카메라
동일 과정
```

**케이블 라우팅:**
1. USB 케이블을 팔 내부 채널에 통과
2. 베이스에서 라즈베리파이로 연결
3. 케이블 여유분 5cm 확보 (관절 움직임)

---

## 9. Phase 7: 소프트웨어 설정

### Step 7.1: 라즈베리파이 OS 설치

```bash
# Raspberry Pi OS 이미지 다운로드
# balenaEtcher로 SD 카드에 flash
# SSH 활성화 (touch ssh)
```

### Step 7.2: 서보 ID 설정

```bash
cd ~/XLeRobot/software
python examples/0_so100_keyboard_joint_control.py
```

**ID 설정 과정:**
1. 서보 펌웨어 툴로 각 모터 ID 할당
2. 중심 각도 캘리브레이션 (2048 = 0°)
3. 최대/최소 각도 제한 설정

### Step 7.3: 카메라 테스트

```bash
# 카메라 인식 확인
ls /dev/video*

# RealSense 테스트
realsense-viewer

# OpenCV 테스트
python -c "import cv2; cap = cv2.VideoCapture(0); print(cap.isOpened())"
```

---

## 10. Phase 8: 테스트 및 캘리브레이션

### Step 8.1: 개별 조인트 테스트

```bash
python examples/0_so100_keyboard_joint_control.py
```

**테스트 항목:**
- [ ] 각 서보 응답 확인
- [ ] 각도 범위 검증
- [ ] 부드러운 움직임 (떨림 없음)
- [ ] 과전류 없음 (멀티미터 확인)

### Step 8.2: 엔드 이펙터 테스트

```bash
python examples/1_so100_keyboard_ee_control.py
```

**테스트:**
- [ ] 순기구학 정확도 (±5mm)
- [ ] 역기구학 수렴 (10회 이내)
- [ ] 특이점 회피

### Step 8.3: 모바일 베이스 테스트

```bash
python examples/4_xlerobot_teleop_keyboard.py
```

**테스트:**
- [ ] 전진/후진 (vx)
- [ ] 좌/우 평행이동 (vy)
- [ ] 제자리 회전 (ω)
- [ ] 대각선 이동
- [ ] 직진성 (10m에 ±10cm)

### Step 8.4: 통합 테스트

```bash
python examples/8_xlerobot_teleop_vr.py  # VR 있는 경우
```

**시나리오:**
1. 전진하며 물체 감지
2. 팔 뻗어 그리퍼로 잡기
3. 들어 올려 90° 회전
4. 다른 위치에 내려놓기

---

## 11. 문제 해결

### 문제 1: 서보가 응답 안 함

**원인:** ID 충돌 또는 전원 부족  
**해결:**
- 서보 ID 재설정
- 배터리 전압 확인 (>11.5V)
- 시리얼 연결 확인

### 문제 2: 팔이 특정 각도에서 멈춤

**원인:** 각도 제한 또는 기계 간섭  
**해결:**
- 서보 최대/최소 각도 확인
- 부품 간섭 확인 (나사 풀림)
- 캘리브레이션 재실행

### 문제 3: 옴니휠이 미끄러짐

**원인:** 휠 정렬 불량  
**해결:**
- 3개 휠 높이 균일하게 조정
- 바닥 면 평평한지 확인
- 모터 토크 증가

### 문제 4: 카메라 인식 안 됨

**원인:** USB 대역폭 부족  
**해결:**
- USB 3.0 포트 사용
- 해상도 낮추기 (1080p → 720p)
- USB 허브 사용 (전원 공급형)

---

## 12. 최종 체크리스트

**기계:**
- [ ] 모든 나사 조임 확인
- [ ] 케이블 정리 및 고정
- [ ] 움직이는 부분에 간섭 없음
- [ ] 배터리 충전 (100%)

**전기:**
- [ ] 전원 ON/OFF 정상
- [ ] 서보 모터 17개 모두 응답
- [ ] 카메라 인식 (2~3개)
- [ ] LED 상태 정상

**소프트웨어:**
- [ ] SSH 접속 가능
- [ ] 조인트 컨트롤 스크립트 실행
- [ ] 카메라 스트림 확인
- [ ] ROS/Python 환경 설정

**안전:**
- [ ] 비상 정지 버튼 작동
- [ ] 과전류 보호 (퓨즈)
- [ ] 배터리 과열 없음
- [ ] 움직임 범위 내 장애물 없음

---

## 참고 자료

- [SO-101 조립 가이드](https://github.com/TheRobotStudio/SO-101)
- [STS3215 서보 매뉴얼](http://feetechrc.com/STS3215.html)
- [IKEA RÅSKOG 설명서](https://www.ikea.com/assembly)
- [RealSense 설정](https://github.com/IntelRealSense/librealsense)
